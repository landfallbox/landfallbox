---
layout: article
title: Git 常用流程
article_header: 
  type: cover
  image:
    src: https://raw.githubusercontent.com/landfallbox/Pictures/master/202402132243405.png
tags: 
    - Git
---

> 阅读本文可能会需要参考 [Git 命令及其作用][1]

如果熟练掌握了每一个 Git 命令及其作用，那么自然可以利用这些命令实现任意想要实现的功能。但，这样的假设显然过于理想化了。事实上，即使熟练掌握了每一个 Git 命令及其作用，也可能遇到记不清该先执行哪个命令再执行哪个命令的时候，因而很有必要将一些常用且步骤较多的流程记录下来以备不时之需。

# 更新 Git 

更新 Git 之前需要先确定当前电脑上安装的 Git 的版本。

如果版本早于 `2.14.1` ，则不得不手动实现更新，即卸载本地已安装的 Git 并到 Git 官网下载最新的版本，因为早于 `2.14.1` 的版本中没有提供更新命令。

如果版本介于 `2.14.1` 和 `2.16.1` 之间，可以使用 `git update` 自动升级 Git 。

如果版本高于 `2.16.1` ，可以使用 `git update-git-for-windows` 实现升级。

以上命令都是在 cmd 中执行的。

> 如果电脑正在使用 VPN，浏览器可以正常访问外网，但命令行报错 `curl: (28) Failed to connect to github.com port 443 after 21066 ms: Timed out` ，即连接超时，一个很可能的原因是因为命令行没有走代理。解决方法自然是配置相应的代理：
>
> ```
>  git config --global http.proxy socks5 127.0.0.1:7890    // sock5代理
>  
>  git config --global http.proxy 127.0.0.1:7890       // http代理
> ```
>
> 上述命令的原理就是把本机作为代理主机，7890 作为代理端口。7890 相对常见是因为 *clash for windows* 默认走的端口就是 7890。给了两种代理协议是因为不同的软件可能对协议的支持存在差异，建议按顺序依次尝试。

# 从零创建一个 Git 仓库

## 初始化 Git

下载、安装完 Git 之后并没有完成创建 Git 仓库的全部前置工作，还需要初始化 Git :

```
 git config --global user.name "Your Name"
 git config --global user.email "email@example.com"
```

引号中的 `Your Name` ，`email@example.com` 改为自己的名字和邮箱，作为用户标识。

## 初始化本地仓库

在文件夹中打开 *git bash* ，执行下面的这句代码可以将此文件夹初始化为一个 git 仓库：

```
 git init
```

## 向本地仓库中添加文件

将文件添加到本地仓库一共需要两个步骤：1、用 `git add` 命令添加文件到缓冲区，2、用 `git commit` 命令将文件提交到本地仓库。

注意，一次性提交多个文件是允许的，即多次使用 ` git add` 添加文件到缓冲区，再通过 `git commit` 将他们一次性全部提交到本地仓库。

## 本地仓库的内容推送到远程仓库（以 Github 为例）

首先需要绑定 SSH Key，不多赘述，读者可自行查询相关资料。

假设已经有一个本地仓库，需要将其中的内容推到远程仓库上，首先得将本地仓库和远程仓库联系起来：

```
 git remote add origin git@github.com:MachinePlay/Gittest.git
```

其中，冒号后的内容应当换成自己的用户名和仓库名。`origin` 其实是给远程仓库起的别名，可以修改，但一般用 `origin` 表示。 

然后就可以将本地仓库的内容推到远程仓库上：

```
 git push -u origin main
 git push origin main
```

其中，`main` 表示分支。`-u` 的作用是将本地名叫 `main` 的分支和远程的 `main` 分支关联起来，从而在以后的推送或者拉取时可以使用简化的命令，关联一次后就不需要再使用 `-u`。

当然，关联是可以修改的，可以使用以下的命令查看关联的远程库的信息：

```
 git remote -v 
```

用以下命令可以删除关联的仓库：

```
 git remote rm origin
```

## 远程仓库的内容拉取到本地仓库（以 Github 为例）

开发时未必先有本地仓库，也可以先建立远程仓库再克隆到本地。有时，我们也需要对别人的项目进行查看，修改，也可以将别人的公开内容拉取到自己的本地仓库。其命令是：

```
 git clone git@github.com:MachinePlay/Gittest.git
```

其中，冒号后的内容应当换成对应的用户名和仓库名。

至此，完成了从零创建一个 Git 仓库的全部内容。

# 版本回退

如果对已提交的内容感到后悔或者现行版本的代码被证明存在问题需要回滚代码，Git 允许对代码进行版本回退。

首先，使用以下代码打印仓库提交日志：

```
 git log
```

查询的结果包括修改时间，修改人和修改内容。以下是一个两次提交的查询结果：

```
 commit 88d885c21216cbedacb1692e08d51afa6d4e32a7 (HEAD -> master)
 Author: yepdlpc <mattbaisteins@gmail.com>
 Date:   Wed Dec 19 20:13:22 2018 +0800
 
     在hello.txt添加了一句话
 
 commit ec4652d5d0b8662fc8730d64b42341d1c363a442
 Author: yepdlpc <mattbaisteins@gmail.com>
 Date:   Wed Dec 19 20:11:42 2018 +0800
 
     添加了hello.txt
```

注意，历史版本的排序是按时间由近及远，所以上面的 88d885c21216cbedacb1692e08d51afa6d4e32a7 是当前版本的版本 id ，ec4652d5d0b8662fc8730d64b42341d1c363a442 是上一个版本的 id。

版本回退的命令是：

```
 git reset --hard HEAD^
```

上面的命令的意思是回退到上一个版本。其中，`HEAD^` 表示上一个版本。如果写作 `HEAD^^` 就表示上两个版本，以此类推。

注意，此时如果用 `git log` 查看版本信息会得到以下结果：

```
 Author: yepdlpc <mattbaisteins@gmail.com>
 Date:   Wed Dec 19 20:11:42 2018 +0800
 
     添加了hello.txt
```

其一，确实证明了本地仓库中的代码回退到我们指定的 “上一个版本” ，但如果此时觉得后悔，希望撤回版本回退，即回到两次提交的状态则不像先前那么容易了，因为此时已查不到其对应的版本号了。此时的解决方法是用以下命令查询命令记录，此处的命令记录指的是用户对 Git 给出的命令的记录。

```
 git reflog
```

运行结果是：

```
 88d885c (HEAD -> master) HEAD@{0}: reset: moving to 88d885c21216cbedacb1692e08d51afa6d4e32a7
 ec4652d HEAD@{1}: reset: moving to HEAD^
 88d885c (HEAD -> master) HEAD@{2}: commit: 在hello.txt添加了一句话
 ec4652d HEAD@{3}: commit (initial): 添加了hello.txt
```

此时就得到了版本 id：88d885c21216cbedacb1692e08d51afa6d4e32a7，据此对版本回退：

```
 git reset --hard 88d885c21216cbedacb1692e08d51afa6d4e32a7
```

> 

[1]:https://landfallbox.github.io/2024/02/13/Git-%E5%91%BD%E4%BB%A4%E5%8F%8A%E5%85%B6%E4%BD%9C%E7%94%A8.html